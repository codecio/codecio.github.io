<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=author content>
<meta name=description content="After some quick tinkering the gitops style deployment is complete. Ran into an issue where the custom domain was being overwritten due to the publish directory generated from Hugo not containing the CNAME file.
To restore the site I had to drill into the pages settings again and set the domain and check enforce https. In order to fix it for future deployments, I&amp;rsquo;ve added the finnp/create-file-action@master action to create the CNAME file on each deployment.">
<meta name=keywords content=",untagged">
<meta name=robots content="noodp">
<meta name=theme-color content>
<link rel=canonical href=https://colecio.com/posts/github-actions-deploy/>
<title>
Github Actions Hugo Deploy :: codecio — A simple hugo website
</title>
<link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css rel=stylesheet type=text/css>
<link rel=stylesheet href=/main.031a8efc33f94f55a4071bf4e91596478a5809fc8c148fab113801189cfd2152.css>
<meta itemprop=name content="Github Actions Hugo Deploy">
<meta itemprop=description content="After some quick tinkering the gitops style deployment is complete. Ran into an issue where the custom domain was being overwritten due to the publish directory generated from Hugo not containing the CNAME file.
To restore the site I had to drill into the pages settings again and set the domain and check enforce https. In order to fix it for future deployments, I&rsquo;ve added the finnp/create-file-action@master action to create the CNAME file on each deployment."><meta itemprop=datePublished content="2021-08-17T22:50:06-05:00">
<meta itemprop=dateModified content="2021-08-17T22:50:06-05:00">
<meta itemprop=wordCount content="148"><meta itemprop=image content="https://colecio.com/">
<meta itemprop=keywords content="untagged,">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://colecio.com/">
<meta name=twitter:title content="Github Actions Hugo Deploy">
<meta name=twitter:description content="After some quick tinkering the gitops style deployment is complete. Ran into an issue where the custom domain was being overwritten due to the publish directory generated from Hugo not containing the CNAME file.
To restore the site I had to drill into the pages settings again and set the domain and check enforce https. In order to fix it for future deployments, I&rsquo;ve added the finnp/create-file-action@master action to create the CNAME file on each deployment.">
<meta property="og:title" content="Github Actions Hugo Deploy">
<meta property="og:description" content="After some quick tinkering the gitops style deployment is complete. Ran into an issue where the custom domain was being overwritten due to the publish directory generated from Hugo not containing the CNAME file.
To restore the site I had to drill into the pages settings again and set the domain and check enforce https. In order to fix it for future deployments, I&rsquo;ve added the finnp/create-file-action@master action to create the CNAME file on each deployment.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://colecio.com/posts/github-actions-deploy/"><meta property="og:image" content="https://colecio.com/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2021-08-17T22:50:06-05:00">
<meta property="article:modified_time" content="2021-08-17T22:50:06-05:00"><meta property="og:site_name" content="codecio">
<meta property="article:published_time" content="2021-08-17 22:50:06 -0500 -0500">
</head>
<body>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ style=text-decoration:none>
<div class=logo>
<span class=logo__mark>></span>
<span class=logo__text>$ cd /home/codecio</span>
<span class=logo__cursor>
</span>
</div>
</a>
<span class=header__right>
<nav class=menu>
<ul class=menu__inner><li><a href=/posts>Blog</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
</span>
</span>
</header>
<div class=content>
<main class=post>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
One minute
</p>
</div>
<article>
<h1 class=post-title>
<a href=https://colecio.com/posts/github-actions-deploy/>Github Actions Hugo Deploy</a>
</h1>
<div class=post-content>
<p>After some quick tinkering the gitops style deployment is complete. Ran into an issue where the custom domain was being overwritten due to the publish directory generated from Hugo not containing the CNAME file.</p>
<p>To restore the site I had to drill into the pages settings again and set the domain and check enforce https. In order to fix it for future deployments, I&rsquo;ve added the <code>finnp/create-file-action@master</code> action to create the CNAME file on each deployment.</p>
<p>Workflow action example.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>name</span>: <span style=color:#ae81ff>hugo CI</span>

<span style=color:#f92672>on</span>:
  <span style=color:#f92672>push</span>:
    <span style=color:#f92672>branches</span>: [ <span style=color:#ae81ff>main ]</span>
  <span style=color:#f92672>pull_request</span>:
    <span style=color:#f92672>branches</span>: [ <span style=color:#ae81ff>main ]</span>

<span style=color:#f92672>jobs</span>:
  <span style=color:#f92672>build</span>:
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>

    <span style=color:#f92672>steps</span>:
      - <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>submodules</span>: <span style=color:#66d9ef>true</span>
          <span style=color:#f92672>fetch-depth</span>: <span style=color:#ae81ff>1</span>

      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Setup Hugo</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-hugo@v2</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>hugo-version</span>: <span style=color:#e6db74>&#39;latest&#39;</span>

      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build</span>
        <span style=color:#f92672>run</span>: <span style=color:#ae81ff>hugo --minify</span>

      <span style=color:#75715e># Setup CNAME</span>
      - <span style=color:#f92672>uses</span>: <span style=color:#e6db74>&#34;finnp/create-file-action@master&#34;</span>
        <span style=color:#f92672>env</span>:
          <span style=color:#f92672>FILE_NAME</span>: <span style=color:#e6db74>&#34;./public/CNAME&#34;</span>
          <span style=color:#f92672>FILE_DATA</span>: <span style=color:#e6db74>&#34;domain.com&#34;</span>

      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>peaceiris/actions-gh-pages@v3</span>
        <span style=color:#f92672>with</span>:
          <span style=color:#f92672>personal_token</span>: <span style=color:#ae81ff>${{ secrets.PERSONAL_TOKEN }}</span>
          <span style=color:#f92672>external_repository</span>: <span style=color:#ae81ff>username/username.github.io</span>
          <span style=color:#f92672>publish_branch</span>: <span style=color:#ae81ff>main</span>
          <span style=color:#f92672>publish_dir</span>: <span style=color:#ae81ff>./public</span>
</code></pre></div>
</div>
</article>
<hr>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=https://colecio.com/tags/untagged/>untagged</a></span>
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
148 Words
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2021-08-18 03:50
</p>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button next">
<a href=https://colecio.com/posts/my-first-post/>
<span class=button__text>My First Post</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</main>
</div>
<footer class=footer>
</footer>
</div>
<script type=text/javascript src=/bundle.min.599099f1f14b78b657d524b28e10e0c5098e7cd46e9c7aed73d577068a276c3ff1bb234cbf29cb313333e83cf411727b43157c91ce5b809e2ffc81664614608e.js integrity="sha512-WZCZ8fFLeLZX1SSyjhDgxQmOfNRunHrtc9V3BoonbD/xuyNMvynLMTMz6Dz0EXJ7QxV8kc5bgJ4v/IFmRhRgjg=="></script>
</body>
</html>